<Page xmlns="http://schemas.nativescript.org/tns.xsd" navigatingTo="onNavigatingTo">
    <ActionBar title="JIRA Export - Мобильное приложение" />
    
    <TabView selectedIndex="0">
        <!-- Вкладка авторизации -->
        <TabViewItem title="Вход в JIRA">
            <ScrollView>
                <StackLayout class="login-content">
                    <Label text="Подключение к JIRA" class="login-title" />
                    
                    <StackLayout class="form-container">
                        <Label text="URL JIRA:" class="form-label" />
                        <TextField text="{{ jiraUrl }}" hint="https://your-jira-instance.com" class="form-input" />
                        
                        <Label text="Email:" class="form-label" />
                        <TextField text="{{ email }}" hint="Введите email" class="form-input" />
                        
                        <Label text="Пароль:" class="form-label" />
                        <TextField text="{{ password }}" hint="Введите пароль" secure="true" class="form-input" />
                        
                        <Button text="Войти" tap="{{ loginToJira }}" class="login-button" />
                    </StackLayout>
                </StackLayout>
            </ScrollView>
        </TabViewItem>
        
        <!-- Вкладка задач -->
        <TabViewItem title="Задачи JIRA">
            <GridLayout rows="auto, auto, *, auto">
                <!-- Панель фильтров -->
                <StackLayout row="0" class="filters-panel">
                    <Label text="Фильтры" class="panel-title" />
                    <GridLayout columns="*, *, *, *" class="filters-grid">
                        <StackLayout col="0">
                            <Label text="Статус:" class="filter-label" />
                            <ListPicker items="{{ statusOptions }}" selectedIndex="{{ selectedStatusIndex }}" class="filter-picker" />
                        </StackLayout>
                        
                        <StackLayout col="1">
                            <Label text="Приоритет:" class="filter-label" />
                            <ListPicker items="{{ priorityOptions }}" selectedIndex="{{ selectedPriorityIndex }}" class="filter-picker" />
                        </StackLayout>
                        
                        <StackLayout col="2">
                            <Label text="Исполнитель:" class="filter-label" />
                            <TextField text="{{ assigneeFilter }}" hint="Имя исполнителя" class="filter-input" />
                        </StackLayout>
                        
                        <StackLayout col="3">
                            <Label text="Поиск:" class="filter-label" />
                            <TextField text="{{ searchFilter }}" hint="Поиск по тексту" class="filter-input" />
                        </StackLayout>
                    </GridLayout>
                    
                    <GridLayout columns="*, *" class="filter-buttons">
                        <Button col="0" text="Применить" tap="{{ applyFilters }}" class="apply-button" />
                        <Button col="1" text="Сбросить" tap="{{ resetFilters }}" class="reset-button" />
                    </GridLayout>
                </StackLayout>
                
                <!-- Панель массовых действий -->
                <StackLayout row="1" class="mass-actions-panel" visibility="{{ selectedTasksCount > 0 ? 'visible' : 'collapsed' }}">
                    <Label text="{{ 'Выбрано задач: ' + selectedTasksCount }}" class="selected-count" />
                    <GridLayout columns="*, *, *" class="mass-buttons">
                        <Button col="0" text="Массовый PDF" tap="{{ bulkExportPdf }}" class="bulk-button" />
                        <Button col="1" text="Снять выделение" tap="{{ clearSelection }}" class="clear-button" />
                        <Button col="2" text="☑ Выбрать все" tap="{{ toggleAllSelection }}" class="select-all-button" />
                    </GridLayout>
                </StackLayout>
                
                <!-- Список задач -->
                <ListView row="2" items="{{ tasks }}" class="tasks-list" itemTap="{{ onTaskTap }}">
                    <ListView.itemTemplate>
                        <GridLayout columns="auto, *, auto, auto" rows="auto, auto, auto" class="task-item">
                            <!-- Чекбокс для выбора -->
                            <Label col="0" row="0" text="{{ selected ? '☑' : '☐' }}" class="task-checkbox" tap="{{ $parents['Page'].bindingContext.toggleTaskSelection }}" />
                            
                            <!-- Основная информация о задаче -->
                            <StackLayout col="1" row="0" rowSpan="2">
                                <Label text="{{ id }}" class="task-id" />
                                <Label text="{{ title }}" class="task-title" textWrap="true" />
                                <Label text="{{ status }}" class="task-status" />
                            </StackLayout>
                            
                            <!-- Дополнительная информация -->
                            <StackLayout col="2" row="0" rowSpan="2">
                                <Label text="{{ priority }}" class="task-priority" />
                                <Label text="{{ assignee }}" class="task-assignee" />
                                <Label text="{{ updated }}" class="task-updated" />
                            </StackLayout>
                            
                            <!-- Кнопки действий -->
                            <StackLayout col="3" row="0" rowSpan="2" class="action-buttons">
                                <Button text="📝" tap="{{ $parents['Page'].bindingContext.showTaskDetails }}" class="action-btn details-btn" />
                                <Button text="📚" tap="{{ $parents['Page'].bindingContext.exportTaskPdf }}" class="action-btn pdf-btn" />
                                <Button text="🔗" tap="{{ $parents['Page'].bindingContext.openInJira }}" class="action-btn jira-btn" />
                            </StackLayout>
                        </GridLayout>
                    </ListView.itemTemplate>
                </ListView>
                
                <!-- Панель пагинации -->
                <StackLayout row="3" class="pagination-panel">
                    <Label text="{{ pageInfo }}" class="page-info" />
                    <GridLayout columns="auto, *, auto, auto, auto">
                        <Button col="0" text="◀ Пред" tap="{{ previousPage }}" isEnabled="{{ canGoPrevious }}" class="nav-button" />
                        <Label col="1" text="Перейти к:" class="goto-label" />
                        <TextField col="2" text="{{ gotoPage }}" class="goto-input" />
                        <Button col="3" text="Перейти" tap="{{ goToPage }}" class="nav-button" />
                        <Button col="4" text="След ▶" tap="{{ nextPage }}" isEnabled="{{ canGoNext }}" class="nav-button" />
                    </GridLayout>
                    <Button text="🔄 Обновить" tap="{{ refreshData }}" class="refresh-button" />
                </StackLayout>
            </GridLayout>
        </TabViewItem>
    </TabView>
</Page>